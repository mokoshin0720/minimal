{% extends 'base.html' %}

{% block header %}
<div class="alert alert-primary" role="alert">
  <h3>Minimal App</h3>
</div>
{% endblock header %}

{% block content %}
<div class="container">
    {% for object in objects %}
    <div class="alert alert-success" role="alert">
      <p>タイトル：<a href="{% url 'detail' object.pk %}"> {{ object.title }}</a></p>
      <p>投稿者： <a href="{% url 'user_posts' object.author.id %}">{{ object.author }}</a></p>
      <p><img src="{{ object.author.image.url }}" width=50></p>
      <div class="like-outer">
            {% include 'like.html' %}
      </div>
    </div>
    {% endfor %}
</div>  

<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<script type="text/javascript">
    $(document).ready(function(event){
        $(document).on('click', '#like', function(event){
            event.preventDefault();
            $.ajax({
                type: 'POST',
                url: "{% url 'like' %}",
                data: {
                    'object_id': $(this).attr('name'),
                    'csrfmiddlewaretoken': '{{ csrf_token }}'},
                dataType: 'json',
                success: function(response){
                    selector = document.getElementsByName(response.object_id);
                    if(response.liked){
                        $(selector).html("<i class='fas fa-lg fa-heart'></i>");
                    }
                    else {
                        $(selector).html("<i class='far fa-lg fa-heart'></i>");
                    }
                    selector2 = document.getElementsByName(response.object_id + "-count");
                    $(selector2).text(response.count);
                }
            });
        });
    });
</script>

{% endblock content %}